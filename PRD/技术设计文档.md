# GameJam报名系统 - 技术设计文档

## 📋 文档信息

| 项目名称 | GameJam报名系统 |
|---------|----------------|
| 文档类型 | 技术设计文档 |
| 文档版本 | v1.0.0 |
| 创建日期 | 2024年 |

---

## 🏗️ 1. 系统架构

### 1.1 整体架构
```
前端应用 (React) ←→ 后端API (Node.js) ←→ 第三方服务 (Tap API)
       ↓                    ↓                    ↓
   用户浏览器            数据库 (MySQL)        认证服务 (OAuth)
```

### 1.2 前端架构
- **框架**：React 18 + TypeScript
- **UI库**：Ant Design 5
- **构建工具**：Vite
- **状态管理**：React Context
- **HTTP客户端**：Axios

### 1.3 后端架构
- **运行时**：Node.js 16+
- **框架**：Express.js
- **数据库**：MySQL 8.0
- **认证**：JWT + OAuth 2.0

---

## 🔧 2. 技术实现

### 2.1 前端实现

#### 2.1.1 状态管理
```typescript
// 用户状态枚举
enum UserStatus {
  NOT_SIGNED_UP = 'not_signed_up',
  SIGNED_UP_NO_GAME = 'signed_up_no_game',
  SIGNED_UP_WITH_GAME = 'signed_up_with_game'
}

// 认证上下文
interface AuthContextType {
  user: UserProfile | null;
  loading: boolean;
  login: () => Promise<void>;
  logout: () => Promise<void>;
  refreshUser: () => Promise<void>;
}
```

#### 2.1.2 组件设计
- **TapLogin**：登录组件，处理OAuth认证
- **SignupForm**：报名表单，收集基本信息
- **GameForm**：游戏表单，提交游戏信息
- **Layout**：布局组件，包含头部和内容区
- **Home**：主页面，根据状态显示不同内容

#### 2.1.3 API服务层
```typescript
// API服务封装
export const tapAuthAPI = {
  getCurrentUser: () => Promise<ApiResponse<UserProfile>>,
  login: () => Promise<ApiResponse<{ token: string; user: UserProfile }>>,
  logout: () => Promise<ApiResponse<void>>
};

export const signupAPI = {
  submitSignup: (data: SignupFormData) => Promise<ApiResponse<UserProfile>>,
  getSignupInfo: () => Promise<ApiResponse<UserProfile>>
};

export const gameAPI = {
  validateGameId: (gameId: string) => Promise<ApiResponse<GameValidationResponse>>,
  submitGameInfo: (gameInfo: GameInfo) => Promise<ApiResponse<UserProfile>>,
  getGameInfo: () => Promise<ApiResponse<GameInfo>>
};
```

### 2.2 后端实现

#### 2.2.1 数据库设计
```sql
-- 用户表
CREATE TABLE users (
  id INT PRIMARY KEY AUTO_INCREMENT,
  tap_id VARCHAR(50) UNIQUE NOT NULL,
  username VARCHAR(100) NOT NULL,
  avatar VARCHAR(255),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 报名信息表
CREATE TABLE signups (
  id INT PRIMARY KEY AUTO_INCREMENT,
  user_id INT NOT NULL,
  phone VARCHAR(20) NOT NULL,
  wechat VARCHAR(50) NOT NULL,
  team_size INT NOT NULL,
  status ENUM('pending', 'approved', 'rejected') DEFAULT 'pending',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id)
);

-- 游戏信息表
CREATE TABLE games (
  id INT PRIMARY KEY AUTO_INCREMENT,
  signup_id INT NOT NULL,
  game_id VARCHAR(50) NOT NULL,
  game_name VARCHAR(100) NOT NULL,
  publisher_name VARCHAR(100) NOT NULL,
  release_type ENUM('小游戏', 'TapPlay', 'WEB', '星火编辑器') NOT NULL,
  theme ENUM('盲盒挑战', '永无止境的闯关', '玩法缝合怪', '经典重开', '重启人生', '萌宠乐园') NOT NULL,
  theme_description TEXT NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (signup_id) REFERENCES signups(id)
);
```

#### 2.2.2 API接口设计
```typescript
// 认证接口
POST /api/auth/tap-login
Body: { code: string }
Response: { token: string, user: UserProfile }

GET /api/user/current
Response: UserProfile

POST /api/auth/logout
Response: void

// 报名接口
POST /api/signup
Body: SignupFormData
Response: UserProfile

GET /api/signup
Response: UserProfile

// 游戏接口
POST /api/game/validate
Body: { gameId: string }
Response: GameValidationResponse

POST /api/game/submit
Body: GameInfo
Response: UserProfile

GET /api/game
Response: GameInfo
```

---

## 🔒 3. 安全设计

### 3.1 认证安全
- **OAuth 2.0**：使用Tap平台的OAuth认证
- **JWT Token**：管理用户会话状态
- **Token刷新**：支持自动刷新过期token

### 3.2 数据安全
- **HTTPS**：所有数据传输使用HTTPS加密
- **输入验证**：前后端双重验证
- **SQL注入防护**：使用参数化查询

### 3.3 权限控制
- **游戏ID验证**：只有游戏管理员才能提交特定游戏
- **用户隔离**：用户只能访问自己的数据
- **API权限**：基于JWT token的API访问控制

---

## 📊 4. 性能优化

### 4.1 前端优化
- **代码分割**：使用React.lazy进行组件懒加载
- **缓存策略**：API响应缓存和本地存储
- **打包优化**：Vite构建优化，减少包体积

### 4.2 后端优化
- **数据库索引**：关键字段建立索引
- **连接池**：数据库连接池管理
- **缓存**：Redis缓存热点数据

### 4.3 网络优化
- **CDN**：静态资源CDN加速
- **压缩**：Gzip压缩响应数据
- **缓存头**：合理的HTTP缓存策略

---

## 🧪 5. 测试策略

### 5.1 前端测试
- **单元测试**：组件和函数单元测试
- **集成测试**：API接口集成测试
- **端到端测试**：完整用户流程测试

### 5.2 后端测试
- **API测试**：接口功能测试
- **数据库测试**：数据操作测试
- **性能测试**：负载和压力测试

---

## 📈 6. 监控和日志

### 6.1 性能监控
- **页面性能**：页面加载时间监控
- **API性能**：接口响应时间监控
- **错误监控**：前端错误收集和分析

### 6.2 业务监控
- **用户行为**：用户操作路径分析
- **报名数据**：报名转化率统计
- **系统状态**：系统运行状态监控

---

## 🚀 7. 部署方案

### 7.1 环境配置
- **开发环境**：本地开发环境
- **测试环境**：功能测试环境
- **生产环境**：正式运行环境

### 7.2 部署流程
1. **代码构建**：`npm run build`
2. **文件部署**：将dist目录部署到Web服务器
3. **配置更新**：更新环境配置
4. **服务启动**：启动Web服务

### 7.3 容器化部署
```dockerfile
# 前端Dockerfile
FROM node:16-alpine as builder
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
EXPOSE 80
```

---

## 📋 8. 总结

### 8.1 技术亮点
1. **现代化技术栈**：React 18 + TypeScript + Ant Design
2. **完善的类型系统**：全面的TypeScript类型定义
3. **模块化设计**：清晰的组件和功能模块划分
4. **安全性考虑**：OAuth 2.0 + JWT + 输入验证
5. **性能优化**：代码分割、缓存策略、数据库优化

### 8.2 扩展性
1. **微服务架构**：支持服务拆分和独立部署
2. **插件化设计**：支持功能模块的即插即用
3. **多租户支持**：可扩展支持多个GameJam活动
4. **国际化**：支持多语言界面
5. **移动端适配**：响应式设计支持移动端

### 8.3 未来规划
1. **实时通知**：WebSocket支持实时状态更新
2. **数据分析**：报名数据统计和分析功能
3. **管理后台**：管理员后台管理系统
4. **API开放**：对外提供API接口
5. **第三方集成**：集成更多第三方服务

---

**文档结束**

*本技术设计文档详细描述了GameJam报名系统的技术架构、实现方案、安全设计、性能优化等各个方面，为开发团队提供了完整的技术指导。* 